<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Random Word Selector</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      margin: 50px;
    }

    table {
      width: 80%;
      margin: 20px auto;
      border-collapse: collapse;
    }

    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: left;
    }

    th {
      background-color: #f2f2f2;
    }

    .used {
      text-decoration: line-through;
      color: #999;
    }

    .hidden {
      display: none;
    }

    #definition {
      margin-top: 20px;
    }
  </style>
</head>
<body>

<h1>Random Word Selector</h1>
<input type="radio" name="level" value="level1" id="level1Radio" checked onclick="updateCategory()"> 
  <label for="level1Radio">Level 1</label>
<input type="radio" name="level" value="level2" id="level2Radio" onclick="updateCategory()"> 
  <label for="level2Radio">Level 2</label>
<input type="radio" name="level" value="level3" id="level3Radio" onclick="updateCategory()"> 
  <label for="level3Radio">Level 3</label>
<input type="radio" name="level" value="level4" id="level4Radio" onclick="updateCategory()"> 
  <label for="level4Radio">Level 4</label>
<input type="radio" name="level" value="level5" id="level5Radio" onclick="updateCategory()"> 
  <label for="level5Radio">Level 5</label>
<input type="radio" name="level" value="extra" id="extraRadio" onclick="updateCategory()"> 
  <label for="extraRadio">Extra Words</label>

<button onclick="generateRandomWord()">Generate Random Word</button>
<button onclick="resetUsedWords()">Reset Used Words</button>
<p id="randomWord" onclick="showDefinition()"></p>
<div id="definition" class="hidden">
  <h3>Definitions</h3>
  <table id="wordDefinitions"></table>
  <h3>Examples</h3>
  <table id="wordExamples"></table>
</div>

<h2>Word Lists</h2>
<p id="numWordsLeft">Words Left: 0</p>
<p id="totalNumWords">Total Words: 0</p>
<table id="level1Table" class="hidden">
  <thead>
    <tr>
      <th>Column 1</th>
      <th>Column 2</th>
      <th>Column 3</th>
      <th>Column 4</th>
      <th>Column 5</th>
    </tr>
  </thead>
  <tbody id="level1List"></tbody>
</table>

<!-- Add similar tables for other levels -->

<script type="module">
  import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.4.0/firebase-app.js';
  import { getDatabase, ref, set, onValue } from 'https://www.gstatic.com/firebasejs/9.4.0/firebase-database.js';
  
  window.generateRandomWord = generateRandomWord;
  window.resetUsedWords = resetUsedWords;
  window.updateCategory = updateCategory;
  window.showDefinition = showDefinition;

const firebaseConfig = {
  apiKey: "AIzaSyAjBQR3CIyFe2B3X764vUAlgZBBv6MXWxU",
  authDomain: "spelling-f0a67.firebaseapp.com",
  databaseURL: "https://spelling-f0a67-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "spelling-f0a67",
  storageBucket: "spelling-f0a67.appspot.com",
  messagingSenderId: "417568436363",
  appId: "1:417568436363:web:f2815fd681ccfaf640a48e",
  measurementId: "G-82924CD1JX"
};

  // Initialize Firebase
  const firebaseApp = initializeApp(firebaseConfig);
  const db = getDatabase(firebaseApp);

  // Define words for each level
  const levelWords = {
    level1: ["word1", "word2", "word3", /*...*/],
    level2: ["word4", "word5", "word6", /*...*/],
    level3: ["word7", "word8", "word9", /*...*/],
    level4: ["word10", "word11", "word12", /*...*/],
    level5: ["word13", "word14", "word15", /*...*/],
    extra: ["extra1", "extra2", "extra3", /*...*/],
  };

  let selectedLevel = "level1";
  const usedWords = {
    level1: [],
    level2: [],
    level3: [],
    level4: [],
    level5: [],
    extra: [],
  };

  function generateRandomWord() {
    const currentLevel = levelWords[selectedLevel];

    if (usedWords[selectedLevel].length === currentLevel.length) {
      document.getElementById("randomWord").innerHTML = "<h1>All words have been used!</h1>";
      return;
    }

    const remainingWords = currentLevel.filter(word => !usedWords[selectedLevel].includes(word));

    if (remainingWords.length === 0) {
      // All words have been used after filtering, update UI accordingly
      document.getElementById("randomWord").innerHTML = "<h1>All words have been used!</h1>";
      return;
    }

    const randomIndex = Math.floor(Math.random() * remainingWords.length);
    const randomWord = remainingWords[randomIndex];

    usedWords[selectedLevel].push(randomWord);

    // Simplified Firebase Realtime Database update
    set(ref(db, `${selectedLevel}/usedWords`), usedWords[selectedLevel]);

    document.getElementById("randomWord").innerHTML = `<h1>${randomWord}</h1>`;

    document.getElementById("definition").classList.add("hidden");
    updateWordList();
  }

function resetUsedWords() {
    Object.keys(usedWords).forEach(level => {
      usedWords[level] = [];
      set(ref(db, `${level}/usedWords`), []).then(() => {
        // Trigger update after the database is updated
        updateWordList();
      });
    });
}

  function updateWordList() {
    const levelTables = {
      level1: document.getElementById("level1Table"),
      level2: document.getElementById("level2Table"),
      level3: document.getElementById("level3Table"),
      level4: document.getElementById("level4Table"),
      level5: document.getElementById("level5Table"),
      extra: document.getElementById("extraTable"),
    };

    const levelListContainers = {
      level1: document.getElementById("level1List"),
      level2: document.getElementById("level2List"),
      level3: document.getElementById("level3List"),
      level4: document.getElementById("level4List"),
      level5: document.getElementById("level5List"),
      extra: document.getElementById("extraList"),
    };

    Object.keys(levelTables).forEach(level => {
      const currentTable = levelTables[level];
      const currentListContainer = levelListContainers[level];

      currentTable.classList.toggle("hidden", selectedLevel !== level);

      currentListContainer.innerHTML = "";

      const currentWords = levelWords[level].sort();
      const numColumns = 5;
      const numRows = Math.ceil(currentWords.length / numColumns);

      for (let row = 0; row < numRows; row++) {
        const tr = document.createElement("tr");

        for (let col = 0; col < numColumns; col++) {
          const index = row * numColumns + col;
          if (index < currentWords.length) {
            const word = currentWords[index];
            const td = document.createElement("td");

            if (usedWords[level].includes(word)) {
              td.innerHTML = `<span class="used">${word}</span>`;
            } else {
              td.textContent = word;
            }

            tr.appendChild(td);
          }
        }

        currentListContainer.appendChild(tr);
      }
    });

    updateWordCount();
  }

function updateWordCount() {
  const numWordsLeft = levelWords[selectedLevel].length - usedWords[selectedLevel].length;
  const totalNumWords = levelWords[selectedLevel].length;

  document.getElementById("numWordsLeft").textContent = `Words Left: ${numWordsLeft}`;
  document.getElementById("totalNumWords").textContent = `Total Words: ${totalNumWords}`;
}

  function updateCategory() {
    selectedLevel = document.querySelector('input[name="level"]:checked').value;
    updateWordList();
  }

  function showDefinition() {
    const randomWord = document.getElementById("randomWord").textContent;

    fetch(`https://wordsapiv1.p.rapidapi.com/words/${randomWord}`, {
      method: "GET",
      headers: {
        "X-RapidAPI-Host": "wordsapiv1.p.rapidapi.com",
        "X-RapidAPI-Key": "06f20456cfmsh1b8e00ea9fb360dp1243b0jsn77475ae1802e"
      }
    })
    .then(response => response.json())
    .then(data => {
      if (data && data.results && data.results.length > 0) {
        const definitions = data.results.map(result => result.definition).filter(Boolean);
        const examples = data.results.map(result => result.examples).flat().filter(Boolean);

        showDefinitionAndExamples(definitions, examples);
      } else {
        document.getElementById("definition").classList.remove("hidden");
        document.getElementById("wordDefinitions").innerHTML = "<tr><td>No definitions available.</td></tr>";
        document.getElementById("wordExamples").innerHTML = "<tr><td>No examples available.</td></tr>";
      }
    })
    .catch(error => {
      console.error("Error fetching data from WordsAPI:", error);
    });
  }

  function showDefinitionAndExamples(definitions, examples) {
    const wordDefinitionsContainer = document.getElementById("wordDefinitions");
    const wordExamplesContainer = document.getElementById("wordExamples");

    wordDefinitionsContainer.innerHTML = "";
    wordExamplesContainer.innerHTML = "";

    for (const definition of definitions) {
      const tr = document.createElement("tr");
      const td = document.createElement("td");
      td.textContent = definition;
      tr.appendChild(td);
      wordDefinitionsContainer.appendChild(tr);
    }

    for (const example of examples.slice(0, 5)) {
      const tr = document.createElement("tr");
      const td = document.createElement("td");
      td.textContent = example;
      tr.appendChild(td);
      wordExamplesContainer.appendChild(tr);
    }

    document.getElementById("definition").classList.remove("hidden");
  }

  // Subscribe to changes in the Firebase database on page load
  Object.keys(levelWords).forEach(level => {
    onValue(ref(db, `${level}/usedWords`), snapshot => {
      const usedWordsFromFirebase = snapshot.val();
      if (usedWordsFromFirebase) {
        usedWords[level] = usedWordsFromFirebase;
      }
      updateWordList();
    });
  });

  // Initial update of the word list
  updateWordList();
</script>

</body>
</html>
